# Отчёт: Проверки 21–30 (FFmpeg, Whisper, API/MCP, JSON, deps, tsconfig, секьюрити, права)

Дата: 2025-10-03
Хост: 178.156.142.35 (ubuntu-4gb-ash-1)
Проект: /root/media-video-maker_project
Сервис: /root/media-video-maker_project/media-video-maker_server

## 21) FFmpeg / фильтры (наличие)
- Команда: `ffmpeg -version | head -n 1`
- Результат: `ffmpeg version 6.1.1-3ubuntu5`
- Вывод: FFmpeg установлен, версия актуальна.

## 22) Whisper CLI
- Команда: `command -v whisper`
- Результат: `whisper-found`
- Health ранее показывал `whisper.available=false` (warning) — вероятна проблема PATH/окружения процесса. Требуется сверка запуска.

## 23) TTS Kokoro/OpenAI (предварительно)
- По коду доступны оба провайдера; прямой runtime-тест TTS не выполнялся в этом блоке (во избежание побочных задач). План: отдельный smoke‑тест с короткой фразой.

## 24) REST API маршруты
- `GET /api/jobs` → OK: `{"jobs":[], ...}`
- `GET /api/status/:id` (несуществующий id) → корректная обработка (не падение сервера).
- `GET /api/capabilities` → OK (см. блок 15 ранее).

## 25) MCP endpoints/порт
- Проверка порта: `ss -tulpn | grep 5123` → `5123-not-listening`
- Вывод: MCP сервер не запущен/не слушает. Требуется запуск/юнит при необходимости.

## 26) Валидация ключевых JSON файлов
- `working-crime-workflow.json` → OK
- `perfect-n8n-workflow.json` → OK
- `test_payload.json` → OK
- `final_test_payload.json` → OK

## 27) Зависимости npm (top-level)
- Список (сокр.): `express@4.21.2`, `fs-extra@11.3.2`, `typescript@5.9.3`, `ts-node@10.9.2`, `zod@3.25.76`
- Вывод: конфликтов не выявлено; версии актуальны.

## 28) tsconfig / ESM
- `module: NodeNext`, `moduleResolution: NodeNext`, `outDir: dist`, `rootDir: src`
- Вывод: конфигурация согласована со сборкой (`npm run build` создаёт `dist`).

## 29) Поиск секретов (паттерны)
- Найдено обращение к `OPENAI_API_KEY` в `src/audio/TTSService.ts` — ожидаемо.
- Отдельно: в локальном репозитории обнаружен API-ключ в `.cursor/.cursor/config.json` (рекомендована ротация и удаление из Git).

## 30) Права директорий
- `/app/output` (см. ранее) — доступно на запись.
- `assets/` и `assets/downloads/` — существуют, права `drwxr-xr-x`.

---

### Краткие выводы 21–30
- FFmpeg установлен; Whisper CLI присутствует, но сервис health видит его как недоступный — проверить PATH/права запуска.
- MCP порт 5123 не слушает — MCP сервер отключён.
- JSON конфиги валидны; deps/tsconfig в порядке; прав доступа достаточно.
- Следующие шаги: проверить PlanInputSchema/валидацию (T16), FileDownloader (T17), CleanupService (T18), а также провести безопасный TTS/Whisper smoke‑тест (T23, T22).
