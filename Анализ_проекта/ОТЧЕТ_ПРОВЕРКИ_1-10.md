# Отчёт: Проверки 1–10 (инвентаризация и окружение)

Дата: 2025-10-03
Хост: 178.156.142.35 (ubuntu-4gb-ash-1)

## 1) Инвентаризация репозитория и ключевых директорий
- Локально (macOS): проект в `/Users/user/media-video-maker`
- Сервер: найдены директории `/root/media-video-maker_project`, `/root/media-video-maker`, `/root/media-video-maker_server`
- Ключевой сервис: `media-video-maker_server` (Node.js/TypeScript)
- Артефакты на сервере: `dist/`, `node_modules/`, множество JSON планов и скриптов

## 2) Состояние git и последние коммиты (локально)
- `git status`: незакоммиченные изменения: удалён `.cursor/settings.json`, изменён `simple_diagnostic_test.json`
- Последние коммиты указывают на фиксы FileDownloader и тестовые задания

## 3) Сопоставление локального и серверного деплоя
- Сервер слушает порт 4123 (процесс node PID присутствует)
- На сервере есть собранный `dist/media-server.js` и актуальный `package.json`
- Различия моделей: на сервере отсутствует `kokoro-v1.0.onnx`

## 4) Карта сервисов
- REST сервер: `media-video-maker_server` (Express)
- MCP сервер: ожидается на 5123 (проверка в следующих шагах)
- Traefik/Docker присутствуют для других сервисов (n8n, db)

## 5) Версии окружения (сервер)
- Node: v18.19.1
- FFmpeg: 6.1.1
- Python: 3.12.3
- Docker/Compose: активно (traefik, n8n, db)

## 6) Модели Kokoro
- Файл `kokoro-v1.0.onnx`: не найден в `/root/media-video-maker_project/media-video-maker_server/`
- Веса `voices-v1.0.bin`: присутствуют по структуре проекта (проверка детально на шаге 11–20)

## 7) Переменные окружения (сервер)
- Фильтрованные ENV по маске `MEDIA_|OPENAI|KOKORO|OUTPUT|ASSETS|PROJECT_ROOT|CRIME|FONT_FILE|LOG_LEVEL`: не обнаружены глобально
- Вывод: вероятно, конфигурация задаётся через defaults или unit‑файлы (systemd/pm2) — требует углублённой проверки

## 8) Порты и health
- Открыт `0.0.0.0:4123` (node) — health возвращает `{status:"healthy"}`
- Внешний health по `http://178.156.142.35:4123/health` отвечает OK

## 9) Docker/Traefik
- traefik, n8n, db — активны через Docker; сам `media-video-maker_server` судя по порту 4123 запущен вне docker (node процесс)
- Маршрутизация к 4123 через traefik не настроена (порт открыт напрямую)

## 10) systemd/pm2
- systemd unit `media-video-maker`: inactive/not found
- PM2: не установлен/не запущен
- Вывод: серверный процесс вероятно запущен вручную/через скрипт/cron — требует фиксации способа автозапуска

---

### Риски/заметки по шагам 1–10
- Отсутствует `kokoro-v1.0.onnx` — TTS Kokoro неработоспособен
- Нет явных ENV — возможны проблемы с путями (`OUTPUT_DIR`, `ASSETS_DIR`, шрифты)
- Нет менеджера процессов (systemd/pm2) — риск падения после рестарта

### Предварительные рекомендации
- Добавить `kokoro-v1.0.onnx` в `media-video-maker_server/`
- Оформить systemd unit или PM2 для стабильного запуска
- Явно задать ENV через unit/pm2/dotenv (MEDIA_PORT, OUTPUT_DIR, FONT_FILE)
