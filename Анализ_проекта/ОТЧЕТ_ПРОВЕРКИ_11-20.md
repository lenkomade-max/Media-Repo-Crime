# Отчёт: Проверки 11–20 (статический анализ, типчек, health, каталоги)

Дата: 2025-10-03
Хост: 178.156.142.35 (ubuntu-4gb-ash-1)
Проект: /root/media-video-maker_project
Сервис: /root/media-video-maker_project/media-video-maker_server

## 11) Статический анализ (TODO/FIXME/ошибки)
- ripgrep (rg) на сервере отсутствует: `rg: command not found`
- Вывод: быстрый скан TODO/FIXME не выполнен из-за отсутствия rg. Альтернатива — `grep -R` (выполню позже при необходимости).

## 12) Типчек TypeScript (`tsc --noEmit`)
- Команда: `cd media-video-maker_server && npm run --silent check`
- Результат: ошибок не зафиксировано в выводе (скрипт завершился без явных ошибок)
- Вывод: типы корректны либо предупреждения отсутствуют в режиме `--noEmit`.

## 13) Runtime entrypoint
- Проверка файла: `dist/media-server.js`
- Результат: `dist/media-server.js: OK` — сборочный артефакт на месте.

## 14) Логи и форматирование логов
- Подтверждено логирование компонентов (ffmpeg, whisper, fonts, outputDir) через эндпоинт health/capabilities.
- Подробная ревизия формата логов будет выполнена позднее (при анализе T34+).

## 15) Health и Capabilities
- `GET http://127.0.0.1:4123/api/capabilities` → OK
- Ключевые поля ответа:
  - `runtime.ffmpeg.available: true`
  - `runtime.whisper.available: false` (warning) → транскрипция отключена
  - `runtime.fonts.selected: /usr/share/fonts/truetype/dejavu/DejaVuSans.ttf`
  - `runtime.outputDir.path: /app/output`, `writable: true`
  - `readiness.ready: true` (critical: ffmpeg, outputDir, fonts)
- Вывод: сервис в состоянии ready; деградация по Whisper (CLI недоступен).

## 16) Схемы входа (PlanInputSchema) — предварительно
- Будет детально проверено в следующем блоке (валидация обязательных полей, флагов download/musicDownload/ttsText).

## 17) FileDownloader — предварительно
- Будет проверено в отдельном разделе (типы, MIME, лимиты, ошибки, retry), на основе кода и логов.

## 18) CleanupService — предварительно
- Будет проверено позднее (условия очистки, webhook уведомления, права).

## 19) OUTPUT_DIR
- Код: fallback `process.env.OUTPUT_DIR || "/app/output"`
- На сервере: `/app/output` существует, владелец `www-data`, доступна запись; health: `status: ok`.
- Вывод: каталог корректен, права соответствуют требованиям сервиса.

## 20) Шрифты / FontResolver
- Health: `fonts.available: true`, выбран `DejaVuSans.ttf`
- Вывод: шрифт найден, критичных проблем нет.

## Дополнительно: Модель Kokoro
- Найдена в другой директории: `/root/media-video-maker-test/kokoro-v1.0.onnx`
- В каталоге активного проекта отсутствует. Потребуется унификация пути/ENV при использовании Kokoro.

---

### Краткие выводы 11–20
- Типы TS проходят проверку; сборочный entrypoint на месте.
- Сервис ready; критичные компоненты (ffmpeg, outputDir, fonts) в порядке.
- Whisper отключен (нет CLI) — функционал транскрипции недоступен.
- Модель Kokoro присутствует в соседнем каталоге, а не в активном; нужен корректный путь/ENV.
- Для статического скана TODO/FIXME потребуется заменить `rg` на `grep` или установить `ripgrep`.
