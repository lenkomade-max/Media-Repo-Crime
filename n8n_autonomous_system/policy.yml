# üõ°Ô∏è –ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã N8N
# –í–µ—Ä—Å–∏—è: 1.0
# –î–∞—Ç–∞: 2025-10-02

# =============================================================================
# –û–°–ù–û–í–ù–´–ï –ü–†–ò–ù–¶–ò–ü–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò
# =============================================================================

security:
  # –ü—Ä–∏–Ω—Ü–∏–ø "Staging First" - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–Ω–∞—á–∞–ª–∞ –≤ staging
  staging_first: true
  
  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –æ–¥–∏–Ω –∏–Ω—Ü–∏–¥–µ–Ω—Ç
  max_attempts: 5
  
  # Cooldown –ø–µ—Ä–∏–æ–¥ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ (—Å–µ–∫—É–Ω–¥—ã)
  cooldown_seconds: 300
  
  # –ü–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è (0.0-1.0)
  auto_apply_threshold: 0.8
  
  # –ü–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Ä—É—á–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
  require_approval_threshold: 0.7
  
  # –¢—Ä–µ–±–æ–≤–∞—Ç—å 2FA –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
  require_2fa: true
  
  # –¶–∏—Ñ—Ä–æ–≤–∞—è –ø–æ–¥–ø–∏—Å—å –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
  digital_signature: true

# =============================================================================
# –ó–ê–ü–†–ï–©–ï–ù–ù–´–ï –û–ü–ï–†–ê–¶–ò–ò
# =============================================================================

forbidden_operations:
  # –û–ø–µ—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ù–ò–ö–û–ì–î–ê –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  never_auto:
    - delete_workflow
    - delete_credentials
    - modify_system_settings
    - drop_database_tables
    - delete_execution_history
    - modify_user_permissions
  
  # –û–ø–µ—Ä–∞—Ü–∏–∏, —Ç—Ä–µ–±—É—é—â–∏–µ —Ä—É—á–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
  require_approval:
    - create_new_credentials
    - modify_existing_credentials
    - change_workflow_permissions
    - bulk_operations
    - system_configuration_changes
  
  # –û–ø–µ—Ä–∞—Ü–∏–∏, —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –≤ staging
  staging_only:
    - experimental_fixes
    - beta_features
    - untested_modifications

# =============================================================================
# –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –û–ë–ù–ê–†–£–ñ–ï–ù–ò–ï
# =============================================================================

monitoring:
  # –ò–Ω—Ç–µ—Ä–≤–∞–ª polling –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (—Å–µ–∫—É–Ω–¥—ã)
  poll_interval_seconds: 10
  
  # Timeout –¥–ª—è webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  webhook_timeout_seconds: 30
  
  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è execution
  execution_timeout_seconds: 600
  
  # –ò–Ω—Ç–µ—Ä–≤–∞–ª health check —Å–∏—Å—Ç–µ–º—ã
  health_check_interval_seconds: 60
  
  # –í–∫–ª—é—á–∏—Ç—å real-time –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
  realtime_monitoring: true
  
  # –í–∫–ª—é—á–∏—Ç—å anomaly detection
  anomaly_detection: true

# =============================================================================
# –°–¢–†–ê–¢–ï–ì–ò–ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø
# =============================================================================

repair_strategies:
  # Credentials –æ—à–∏–±–∫–∏
  credentials:
    confidence_threshold: 0.9
    max_retry_attempts: 3
    actions:
      - refresh_token
      - validate_permissions
      - rotate_credentials
  
  # Network/Timeout –æ—à–∏–±–∫–∏
  network:
    confidence_threshold: 0.8
    max_retry_attempts: 5
    actions:
      - increase_timeout
      - add_retry_logic
      - implement_circuit_breaker
  
  # External API –æ—à–∏–±–∫–∏
  external_api:
    confidence_threshold: 0.7
    max_retry_attempts: 3
    actions:
      - add_exponential_backoff
      - implement_fallback
      - cache_responses
  
  # Mapping/Validation –æ—à–∏–±–∫–∏
  mapping:
    confidence_threshold: 0.9
    max_retry_attempts: 2
    actions:
      - fix_field_paths
      - add_validation
      - provide_defaults
  
  # Internal function –æ—à–∏–±–∫–∏
  internal:
    confidence_threshold: 0.6
    max_retry_attempts: 2
    actions:
      - replace_with_safe_alternative
      - add_error_handling
      - simplify_logic

# =============================================================================
# –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –ò –≠–°–ö–ê–õ–ê–¶–ò–Ø
# =============================================================================

notifications:
  # –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–Ω–∞–ª—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  channels:
    telegram:
      enabled: true
      bot_token: "${TELEGRAM_BOT_TOKEN}"
      chat_id: "${TELEGRAM_CHAT_ID}"
    
    slack:
      enabled: true
      webhook_url: "${SLACK_WEBHOOK_URL}"
      channel: "#n8n-alerts"
    
    email:
      enabled: true
      smtp_host: "${EMAIL_SMTP_HOST}"
      smtp_port: 587
      from_email: "${EMAIL_FROM}"
      to_emails: ["${ADMIN_EMAIL}"]
  
  # –£—Ä–æ–≤–Ω–∏ —ç—Å–∫–∞–ª–∞—Ü–∏–∏
  escalation_levels:
    info:
      notify_channels: ["telegram"]
      require_ack: false
    
    warning:
      notify_channels: ["telegram", "slack"]
      require_ack: false
    
    critical:
      notify_channels: ["telegram", "slack", "email"]
      require_ack: true
      escalation_timeout: 300  # 5 –º–∏–Ω—É—Ç
    
    emergency:
      notify_channels: ["telegram", "slack", "email"]
      require_ack: true
      escalation_timeout: 60   # 1 –º–∏–Ω—É—Ç–∞
      require_immediate_response: true

# =============================================================================
# –ê–£–î–ò–¢ –ò –õ–û–ì–ò–†–û–í–ê–ù–ò–ï
# =============================================================================

audit:
  # –í–∫–ª—é—á–∏—Ç—å immutable audit trail
  immutable_logging: true
  
  # –•—Ä–∞–Ω–∏—Ç—å –ø–æ–ª–Ω—ã–µ diff'—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π
  store_full_diffs: true
  
  # –ü–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤ (–¥–Ω–∏)
  retention_days: 365
  
  # –°–∂–∞—Ç–∏–µ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤
  compress_old_logs: true
  
  # –≠–∫—Å–ø–æ—Ä—Ç –≤ –≤–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
  export_to_external: true
  
  # –¶–∏—Ñ—Ä–æ–≤–∞—è –ø–æ–¥–ø–∏—Å—å –∑–∞–ø–∏—Å–µ–π
  sign_entries: true
  
  # –ü–æ–ª—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
  log_fields:
    - timestamp
    - user_id
    - action_type
    - workflow_id
    - node_id
    - before_state
    - after_state
    - confidence_score
    - approval_status
    - execution_id

# =============================================================================
# –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ò –í–ê–õ–ò–î–ê–¶–ò–Ø
# =============================================================================

testing:
  # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ staging
  mandatory_staging_test: true
  
  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ staging (—Å–µ–∫—É–Ω–¥—ã)
  min_staging_duration: 300
  
  # Canary deployment –ø—Ä–æ—Ü–µ–Ω—Ç —Ç—Ä–∞—Ñ–∏–∫–∞
  canary_traffic_percent: 10
  
  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
  auto_rollback_on_error: true
  
  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è canary —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  max_canary_duration: 1800  # 30 –º–∏–Ω—É—Ç
  
  # –¢–µ—Å—Ç–æ–≤—ã–µ payload'—ã
  test_payloads:
    - name: "basic_test"
      data: {"topic": "Test execution"}
    - name: "complex_test"
      data: {"topic": "Complex criminal story", "duration": 60}
    - name: "edge_case_test"
      data: {"topic": "", "invalid_field": null}

# =============================================================================
# –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –ò –†–ï–°–£–†–°–´
# =============================================================================

performance:
  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
  max_concurrent_operations: 5
  
  # Timeout –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π (—Å–µ–∫—É–Ω–¥—ã)
  operation_timeout: 300
  
  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU (%)
  max_cpu_usage: 80
  
  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ (MB)
  max_memory_usage: 1024
  
  # –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞
  gc_interval_seconds: 300

# =============================================================================
# –ò–ù–¢–ï–ì–†–ê–¶–ò–ò –ò –í–ù–ï–®–ù–ò–ï –°–ï–†–í–ò–°–´
# =============================================================================

integrations:
  # N8N API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
  n8n:
    api_url: "${N8N_API_URL}"
    admin_token: "${N8N_ADMIN_TOKEN}"
    ssh_host: "${SSH_HOST}"
    max_retries: 3
    timeout: 30
  
  # PostgreSQL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
  postgresql:
    host: "${DB_HOST}"
    port: 5432
    database: "${DB_NAME}"
    username: "${DB_USER}"
    password: "${DB_PASSWORD}"
    max_connections: 10
  
  # MCP Server –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
  mcp_server:
    url: "http://178.156.142.35:4123"
    timeout: 300
    max_retries: 3
  
  # Vault –¥–ª—è —Å–µ–∫—Ä–µ—Ç–æ–≤
  vault:
    enabled: false
    url: "${VAULT_URL}"
    token: "${VAULT_TOKEN}"

# =============================================================================
# –ú–ï–¢–†–ò–ö–ò –ò KPI
# =============================================================================

metrics:
  # –¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
  targets:
    mttr_seconds: 300        # Mean Time To Repair
    success_rate: 0.95       # 95% —É—Å–ø–µ—à–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
    availability: 0.999      # 99.9% uptime
    max_error_rate: 0.01     # –ú–∞–∫—Å–∏–º—É–º 1% –æ—à–∏–±–æ–∫
  
  # –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫
  collection_interval: 60
  
  # –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫
  export_prometheus: true
  export_grafana: true
  
  # –ê–ª–µ—Ä—Ç—ã –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º
  alerts:
    mttr_exceeded:
      threshold: 600  # 10 –º–∏–Ω—É—Ç
      severity: "warning"
    
    success_rate_low:
      threshold: 0.90
      severity: "critical"
    
    system_unavailable:
      threshold: 0.95
      severity: "emergency"

# =============================================================================
# –†–ï–ñ–ò–ú–´ –†–ê–ë–û–¢–´
# =============================================================================

modes:
  # –†–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  default_mode: "production"
  
  # –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ–∂–∏–º—ã
  available_modes:
    development:
      auto_apply_threshold: 0.5
      require_approval_threshold: 0.3
      max_attempts: 10
      cooldown_seconds: 60
    
    staging:
      auto_apply_threshold: 0.7
      require_approval_threshold: 0.5
      max_attempts: 7
      cooldown_seconds: 120
    
    production:
      auto_apply_threshold: 0.8
      require_approval_threshold: 0.7
      max_attempts: 5
      cooldown_seconds: 300
    
    emergency:
      auto_apply_threshold: 0.9
      require_approval_threshold: 0.8
      max_attempts: 3
      cooldown_seconds: 600

# =============================================================================
# COMPLIANCE –ò –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï
# =============================================================================

compliance:
  # –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
  standards:
    - "ISO 27001"
    - "SOC 2"
    - "GDPR"
  
  # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∞—É–¥–∏—Ç–∞
  mandatory_audit_fields:
    - user_identification
    - action_timestamp
    - resource_affected
    - change_justification
    - approval_chain
  
  # –ü–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è compliance
  compliance_retention_years: 7
  
  # –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ sensitive –¥–∞–Ω–Ω—ã—Ö
  encrypt_sensitive_data: true
  
  # –†–µ–≥—É–ª—è—Ä–Ω—ã–µ compliance –ø—Ä–æ–≤–µ—Ä–∫–∏
  compliance_checks:
    frequency: "monthly"
    automated: true
    report_generation: true

# =============================================================================
# –í–ï–†–°–ò–û–ù–ò–†–û–í–ê–ù–ò–ï –ò –û–ë–ù–û–í–õ–ï–ù–ò–Ø
# =============================================================================

versioning:
  # –í–µ—Ä—Å–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  config_version: "1.0"
  
  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  auto_updates: false
  
  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
  check_updates: true
  update_check_interval: "daily"
  
  # Backup –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
  backup_before_update: true
  
  # Rollback capability
  enable_rollback: true
  max_rollback_versions: 10

---
# –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ –ø–æ–ª–∏—Ç–∏–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
# –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å review –∏ approval
# –í–µ—Ä—Å–∏—è –¥–æ–ª–∂–Ω–∞ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
