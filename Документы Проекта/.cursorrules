# ЯЗЫК И РЕЖИМ
- Всегда отвечай на русском.
- Работай итерациями: План → Мини-патч → Diff → Команды проверки → Результат.
- Если есть сомнение — сделай самый маленький безопасный шаг и покажи diff.

# ТАБУ
- НЕ редактируй dist/ (только src/), dist/ перегенерируется сборкой.
- НЕ добавляй зависимости без прямого запроса.
- НЕ меняй публичные API и форматы JSON без явного одобрения.
- НЕ удаляй файлы автоматически (только по моей прямой команде).

# ТРЕБОВАНИЯ ПО ESM
- ESM/NodeNext: импорты в рантайме с явными .js расширениями.
- Если ловишь TS-ошибки (TS2307/TS2339 и пр.) — укажи точные файлы/строки и предложи минимальный фикс.

# ПОШАГОВЫЙ КОНТУР РАБОТЫ (СТАДИИ)
S0: Прочитай MANIFEST/DEV_PROMPT.md и перечисли риски/долги.
S1: Чистая сборка: `npm run build`. Если падает — приоритизируй типовые ошибки TS и правь минимально.
S2: Валидация сценария JSON: проверить наличие файлов, времена start/end, допустимые blendMode.
S3: Быстрый прокси-рендер (низкое качество) только базового таймлайна → сохранить out/proxy_base.mp4.
S4: Быстрый прокси-рендер с оверлеями (blend) → out/proxy_overlays.mp4.
S5: Кадровая проверка (QA): извлечь кадры, сравнить ожидаемые зоны/наложения, убедиться, что база видна.
S6: Whisper-сабтайтлы: сгенерировать/подхватить .srt/.ass, наложить в прокси-рендер.
S7: TTS (Kokoro): сгенерировать дорожку, замиксовать с музыкой (ducking), прокси-рендер.
S8: Полный рендер (полное качество) → out/final.mp4. Только когда S0–S7 зелёные.

# ОВЕРЛЕИ/BLEND
- Видео-оверлеи = эффекты, не контент. Накладывай через ffmpeg blend: overlay, screen, multiply, softlight, hardlight, lighten, darken.
- Несколько оверлеев — цепочкой через tmp-метки в filter_complex.

# ТЕСТИРОВАНИЕ/ОТЧЁТ
- На каждый шаг давай:
  1) краткий диагноз,
  2) diff (только изменённые файлы),
  3) команды для запуска (точные),
  4) где лежит результат (путь к файлам),
  5) критерии «принято/не принято».

# ГРАНИЦЫ
- Сначала предложи скрипты/команды; правки кода — только если реально нужны.
- Если нужна новая структура/папка/скрипт — предложи шаблон и сразу действуй по манифесту, без отдельного согласования. Обязательно покажи diff и команды.